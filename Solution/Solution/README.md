# Отчет по модулю «Учет финансов» ВШЭ-Банк

## 1. Общая идея решения

### Реализованный функционал:
- **Управление счетами**: 
  - Создание, редактирование, удаление счетов.
  - Пересчет баланса при несоответствиях.
- **Управление категориями**:
  - Создание категорий (доходы/расходы).
  - Удаление категорий с каскадным удалением операций.
- **Управление операциями**:
  - Создание операций (доходы/расходы) с автоматическим обновлением баланса.
  - Удаление операций с откатом изменений в балансе.
- **Аналитика**:
  - Подсчет разницы доходов и расходов за период.
  - Группировка операций по категориям.
- **Импорт/Экспорт данных**:
  - Поддержка форматов: CSV, JSON, YAML.
  - Использование паттернов **Шаблонный метод** (импорт) и **Посетитель** (экспорт).

### Изменения в требованиях:
- Добавлена возможность **ручного пересчета баланса**.
- Реализована **валидация данных** при создании объектов (например, запрет операций с отрицательной суммой).
- Внедрено **логирование времени выполнения** операций через паттерн **Декоратор**.

---

## 2. Принципы SOLID и GRASP

### SOLID:
1. **Single Responsibility (SRP)**:
   - Каждый класс отвечает за одну задачу:
     - `BankAccountFacade`: управление счетами.
     - `CsvExporter`: экспорт в CSV.
     - `JsonDataImporter`: импорт из JSON.

2. **Open/Closed (OCP)**:
   - Расширение функционала через декораторы (например, `TimedCommandDecorator`).
   - Поддержка новых форматов импорта/экспорта без изменения существующего кода.

3. **Liskov Substitution (LSP)**:
   - Классы импорта (`CsvDataImporter`, `JsonDataImporter`) реализуют общий интерфейс `IDataImporter`.

4. **Dependency Inversion (DIP)**:
   - Зависимости между модулями инкапсулированы через интерфейсы:
     - `ICommand<T>` для команд.
     - `IDataExporter` для экспорта.

### GRASP:
1. **High Cohesion**:
   - Классы сгруппированы по функциональности:
     - `Domain/Models`: модели данных.
     - `Infrastructure/Exporters`: логика экспорта.

2. **Low Coupling**:
   - Фасады (`BankAccountFacade`) уменьшают связность между UI и бизнес-логикой.
   - Команды (`CreateAccountCommand`) изолируют взаимодействие с фасадами.

---

## 3. Паттерны GoF

### 1. Фасад (Facade)
- **Цель**: Упростить взаимодействие с подсистемой счетов, категорий и операций.
- **Реализация**: 
  - `BankAccountFacade`, `CategoryFacade`, `OperationFacade`.
- **Важность**: Сокрытие сложности создания объектов и валидации.

### 2. Команда (Command) + Декоратор (Decorator)
- **Цель**: Инкапсуляция запросов и добавление функционала (замер времени).
- **Реализация**:
  - `ICommand<T>`: базовый интерфейс команд.
  - `CreateAccountCommand`: создание счета.
  - `TimedCommandDecorator<T>`: декоратор для логирования времени.
- **Важность**: Гибкость добавления новых сценариев (например, отмена операций).

### 3. Шаблонный метод (Template Method)
- **Цель**: Унификация алгоритма импорта данных.
- **Реализация**:
  - Абстрактный класс `DataImporter` с методами `ReadFile` и `ParseData`.
  - `CsvDataImporter`: парсинг CSV.
- **Важность**: Повторное использование кода для разных форматов.

### 4. Посетитель (Visitor)
- **Цель**: Реализация экспорта данных в разные форматы.
- **Реализация**:
  - `IDataExporter` с методами `Export(BankAccount)`, `Export(Category)`, `Export(Operation)`.
  - `CsvExporter`: генерация CSV.
- **Важность**: Отделение логики экспорта от моделей данных.

---

## 4. Контейнер и Dependency Injection (DI)

### Принцип работы контейнера:
- **Ручное внедрение зависимостей**: 
  - Фасады создаются явно и передаются в команды.
  - DI в тестах:

    Зависимости инжектируются через конструкторы в тестовых классах.
     ```csharp
    var accountFacade = new BankAccountFacade();
     var command = new CreateAccountCommand(accountFacade, "Счет", 10000);
    ```
## 5. Тестирование

### Реализованные тесты:
- **Модульные тесты (xUnit)**:

  - Проверка создания счетов, категорий, операций.

  - Тесты импорта/экспорта данных.

  - Покрытие кода (Coverlet):

  - Более 70% покрытия основных сценариев.

Пример теста:

```csharp
[Fact]
public void CreateAccount_ShouldIncreaseBalance()
{
    var facade = new BankAccountFacade();
    var account = facade.CreateAccount("Счет", 10000);
    Assert.Equal(10000, account.Balance);
}
```

## 6. Дополнительная информация

### Структура проекта:
```
FinanceModule/
├── Domain/              # Доменная логика
│   ├── Models/          # Модели данных
│   ├── Services/        # Фасады
│   └── Interfaces/      # Интерфейсы
├── Application/         # Сценарии использования
│   ├── Commands/        # Паттерн Команда
│   ├── Decorators/      # Паттерн Декоратор
│   └── Interfaces/      # Интерфейсы
├── Infrastructure/      # Инфраструктура
│   ├── Exporters/       # Экспорт данных
│   ├── Importers/       # Импорт данных
│   └── Interfaces/      # Интерфейсы
├── Console/             # Консольный интерфейс
├── Tests/               # Тесты
│   ├── Commands/        # Тесты комманд
│   ├── Exporters/       # Тесты экспорта
│   ├── Importers/       # Тесты импорта
│   └── Services/        # Тесты фасадов
```

### Инструкции по запуску:
Установите .NET 8.0 SDK.

Восстановите зависимости:
```bash
dotnet restore
```
Запустите приложение
```bash
dotnet run --project FinanceModule.Console
```



**Выполнил \
Мушкат Илья Валерьевич БПИ238**